SRCS_DRIVERS_NVSETS += $(wildcard nvsets/*.c)
SRCS_DRIVERS_CENTAURI += $(wildcard centauri/*.c)
SRCS_DRIVERS_CENTAURI += $(wildcard centauri/phy/*.c)

OBJS_DRIVERS_NVSETS += $(addprefix $(BUILD)/, $(SRCS_DRIVERS_NVSETS:.c=.o))
OBJS_DRIVERS_CENTAURI += $(addprefix $(BUILD)/, $(SRCS_DRIVERS_CENTAURI:.c=.o))

OBJS_DIR += $(sort $(dir $(OBJS_DRIVERS_NVSETS)))
OBJS_DIR += $(sort $(dir $(OBJS_DRIVERS_CENTAURI)))

LIB_DRIVERS_NVSETS_ARCHIVE = $(BUILD)/$(LIB_DRIVERS_NVSETS)
LIB_DRIVERS_NVSETS_OBJS += $(OBJS_DRIVERS_NVSETS)

LIB_DRIVERS_CENTAURI_ARCHIVE = $(BUILD)/$(LIB_DRIVERS_CENTAURI)
LIB_DRIVERS_CENTAURI_OBJS += $(OBJS_DRIVERS_CENTAURI)

ARCHIVE_FILES += $(LIB_DRIVERS_NVSETS_ARCHIVE)
ARCHIVE_FILES += $(LIB_DRIVERS_CENTAURI_ARCHIVE)

LOCAL_CFLAGS += -I$(TOP)/drivers/centauri
LOCAL_CFLAGS += -I$(TOP)/drivers/centauri/phy
LOCAL_CFLAGS += -DCSR_ACCESS=

all: | $(OBJS_DIR) $(ARCHIVE_FILES)
$(OBJS_DIR):
	$(MKDIR) -p $@

$(BUILD)/%.o: %.c
	$(ECHO) "CC $<"
	$(CC) -DFILE_RELATIVE=\"$(patsubst $(TOP)/%,%,$(abspath $<))\" \
		  -DFILE_NOPATH=\"$(notdir $<)\" \
		  $(LOCAL_CFLAGS) $(CFLAGS) -c -o $@ $<

$(BUILD)/%.a:
	$(ECHO) "AR $@"
	$(AR) -cr $@ $^

$(LIB_DRIVERS_NVSETS_ARCHIVE): $(LIB_DRIVERS_NVSETS_OBJS)

$(LIB_DRIVERS_CENTAURI_ARCHIVE): $(LIB_DRIVERS_CENTAURI_OBJS)

-include $(OBJS_DRIVERS_NVSETS:%.o=%.d)
-include $(OBJS_DRIVERS_CENTAURI:%.o=%.d)
